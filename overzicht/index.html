<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projecten & Opdrachten</title>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#ffd736',
          },
          boxShadow: {
            card: '0 4px 12px rgba(0, 0, 0, 0.05)',
          },
        },
      },
    };
  </script>
  <style>
    /* Glassmorphism effect on table container */
    .glass-table {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px 0 rgba(255, 255, 255, 0.1);
    }
    /* Table row hover highlight */
    tbody tr:hover {
      background-color: rgba(255 215 54 / 0.2);
      transition: background-color 0.3s ease;
    }
    /* Hide scrollbars */
    ::-webkit-scrollbar {
      display: none;
    }
    -ms-overflow-style: none;
    scrollbar-width: none;

    /* Truncate description */
    td.description {
      max-width: 250px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen font-sans p-4">

  <!-- Page Header -->
  <header class="text-center mb-8">
    <h1 class="text-4xl sm:text-5xl font-bold text-primary drop-shadow-lg">
      Projecten & opdrachten
    </h1>
    <p class="mt-2 text-gray-300">
      Bekijk actuele projecten, filter op status, tags of zoek op titel en opdrachtgever.
    </p>
  </header>

  <!-- Main Content -->
  <main x-data="projectsList()" class="space-y-6" @keydown.escape.window="modalOpen = false">

    <!-- Filters -->
    <div class="flex flex-col sm:flex-row sm:items-center gap-2">
      <input
        x-model="query"
        type="text"
        placeholder="Zoek (titel, opdrachtgever, locatie, tag)…"
        class="flex-1 px-4 py-2 rounded-lg border border-gray-600 bg-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"
      />
      <select
        x-model="selectedStatus"
        class="px-4 py-2 rounded-lg border border-gray-600 bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary"
      >
        <option value="">Alle statussen</option>
        <option value="Open">Open</option>
        <option value="Bezig">Bezig</option>
        <option value="Gesloten">Gesloten</option>
      </select>
      <template x-if="selectedTag">
        <div class="mt-2 sm:mt-0 sm:ml-4 flex items-center space-x-2 text-sm">
          <span>Filter op tag:</span>
          <span class="inline-block bg-primary/20 text-primary font-semibold px-2 py-0.5 rounded">
            <span x-text="selectedTag"></span>
          </span>
          <button
            @click="selectedTag=''; query=''; selectedStatus=''"
            class="text-primary hover:underline focus:outline-none"
            aria-label="Reset filters"
          >
            ✕ Reset
          </button>
        </div>
      </template>
    </div>

    <!-- Responsive Table Container with glass effect -->
    <div class="overflow-x-auto glass-table max-w-full">

      <table class="min-w-full text-sm divide-y divide-gray-700" role="table" aria-label="Lijst van projecten">
        <thead class="bg-gray-700">
          <tr>
            <th
              class="px-4 py-3 text-left text-xs font-semibold uppercase cursor-pointer select-none"
              @click="sortBy('title')"
              :class="sortField === 'title' ? 'text-primary' : ''"
              scope="col"
              tabindex="0"
              @keydown.enter.prevent="sortBy('title')"
              aria-sort="none"
            >
              Titel
              <span x-show="sortField === 'title'" x-text="sortDirection === 'asc' ? '▲' : '▼'"></span>
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-semibold uppercase cursor-pointer select-none"
              @click="sortBy('client')"
              :class="sortField === 'client' ? 'text-primary' : ''"
              scope="col"
              tabindex="0"
              @keydown.enter.prevent="sortBy('client')"
              aria-sort="none"
            >
              Opdrachtgever
              <span x-show="sortField === 'client'" x-text="sortDirection === 'asc' ? '▲' : '▼'"></span>
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-semibold uppercase cursor-pointer select-none"
              @click="sortBy('location')"
              :class="sortField === 'location' ? 'text-primary' : ''"
              scope="col"
              tabindex="0"
              @keydown.enter.prevent="sortBy('location')"
              aria-sort="none"
            >
              Locatie
              <span x-show="sortField === 'location'" x-text="sortDirection === 'asc' ? '▲' : '▼'"></span>
            </th>
            <th class="px-4 py-3 text-left text-xs font-semibold uppercase" scope="col">Beschrijving</th>
            <th class="px-4 py-3 text-left text-xs font-semibold uppercase" scope="col">Tags</th>
            <th
              class="px-4 py-3 text-left text-xs font-semibold uppercase cursor-pointer select-none"
              @click="sortBy('status')"
              :class="sortField === 'status' ? 'text-primary' : ''"
              scope="col"
              tabindex="0"
              @keydown.enter.prevent="sortBy('status')"
              aria-sort="none"
            >
              Status
              <span x-show="sortField === 'status'" x-text="sortDirection === 'asc' ? '▲' : '▼'"></span>
            </th>
            <th class="px-4 py-3 text-left text-xs font-semibold uppercase" scope="col">Periode</th>
            <th class="px-4 py-3 text-left text-xs font-semibold uppercase" scope="col">Rollen</th>
            <th class="px-4 py-3 text-center text-xs font-semibold uppercase" scope="col">Info</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-gray-700">
          <template x-for="project in sortedProjects()" :key="project.id">
            <tr
              tabindex="0"
              @click="openModal(project)"
              @keydown.enter.prevent="openModal(project)"
              class="cursor-pointer transition-opacity duration-200 opacity-90 hover:opacity-100"
              :aria-label="'Open details voor ' + project.title"
            >
              <td class="px-4 py-3 font-medium text-white" x-text="project.title"></td>
              <td class="px-4 py-3 text-white" x-text="project.client"></td>
              <td class="px-4 py-3 text-white" x-text="project.location"></td>
              <td class="px-4 py-3 text-white description" :title="project.description" x-text="project.description"></td>
              <td class="px-4 py-3">
                <template x-for="tag in project.tags" :key="tag">
                  <button
                    @click.stop.prevent="selectedTag = tag; query=''; selectedStatus=''"
                    class="inline-block bg-primary/20 text-primary text-xs font-semibold mr-1 px-2 py-0.5 rounded hover:bg-primary/40 transition"
                    type="button"
                    :aria-label="'Filter op tag ' + tag"
                  >
                    <span x-text="tag"></span>
                  </button>
                </template>
              </td>
              <td class="px-4 py-3">
                <span
                  x-text="project.status"
                  :class="{
                    'bg-green-100 text-green-800': project.status === 'Open',
                    'bg-yellow-100 text-yellow-800': project.status === 'Bezig',
                    'bg-red-100 text-red-800': project.status === 'Gesloten'
                  }"
                  class="text-xs font-semibold px-2 py-1 rounded"
                ></span>
              </td>
              <td class="px-4 py-3 text-white" x-text="(project.start || '-') + ' – ' + (project.end || '-')"></td>
              <td class="px-4 py-3 text-white" x-text="project.roles.join(', ')"></td>
              <td class="px-4 py-3 text-center">
                <a
                  :href="project.link"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-primary hover:underline"
                  @click.stop
                  @keydown.enter.stop
                  :aria-label="'Meer informatie over ' + project.title"
                >
                  Meer info
                </a>
              </td>
            </tr>
          </template>
        </tbody>
      </table>

      <div
        x-show="sortedProjects().length === 0"
        class="p-4 text-center text-gray-400"
      >
        Geen projecten gevonden.
      </div>

    </div>

    <!-- Modal for project details -->
    <div
      x-show="modalOpen"
      class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"
      style="backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);"
      @click.outside="modalOpen = false"
      x-trap.noscroll="modalOpen"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      role="dialog"
      aria-modal="true"
      :aria-labelledby="'modal-title-' + (modalProject ? modalProject.id : '')"
    >
      <div class="bg-gray-900 rounded-lg max-w-lg w-full p-6 relative text-white shadow-lg">
        <button
          @click="modalOpen = false"
          class="absolute top-3 right-3 text-gray-400 hover:text-white focus:outline-none"
          aria-label="Sluit modal"
        >
          ✕
        </button>
        <template x-if="modalProject">
          <div>
            <h2
              class="text-2xl font-bold mb-2"
              :id="'modal-title-' + modalProject.id"
              x-text="modalProject.title"
            ></h2>
            <p class="text-gray-400 mb-4" x-text="modalProject.client + ' — ' + modalProject.location"></p>
            <p class="mb-4" x-text="modalProject.description"></p>

            <p class="mb-2 font-semibold">Tags:</p>
            <div class="mb-4 flex flex-wrap gap-2">
              <template x-for="tag in modalProject.tags" :key="tag">
                <span class="inline-block bg-primary/20 text-primary text-xs font-semibold px-2 py-1 rounded">
                  <span x-text="tag"></span>
                </span>
              </template>
            </div>

            <p class="mb-2 font-semibold">Status:</p>
            <span
              x-text="modalProject.status"
              :class="{
                'bg-green-100 text-green-800': modalProject.status === 'Open',
                'bg-yellow-100 text-yellow-800': modalProject.status === 'Bezig',
                'bg-red-100 text-red-800': modalProject.status === 'Gesloten'
              }"
              class="text-xs font-semibold px-2 py-1 rounded"
            ></span>

            <p class="mt-4 mb-2 font-semibold">Periode:</p>
            <p x-text="(modalProject.start || '-') + ' – ' + (modalProject.end || '-')"></p>

            <p class="mt-4 mb-2 font-semibold">Rollen:</p>
            <p x-text="modalProject.roles.join(', ')"></p>

            <a
              :href="modalProject.link"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-block mt-6 text-primary hover:underline"
            >
              Meer informatie (nieuw tabblad)
            </a>
          </div>
        </template>
      </div>
    </div>
  </main>

  <script>
    function projectsList() {
      return {
        query: '',
        selectedStatus: '',
        selectedTag: '',
        sortField: 'title',
        sortDirection: 'asc',
        modalOpen: false,
        modalProject: null,

        projects: [
          {
            id: 1,
            title: 'Digitally Autonomous Work environment (DAW)',
            client: 'Rijksoverheid',
            location: 'Nederland',
            description: 'Creative Developer‑rol voor het ontwikkelen van een Digitally Autonomous Work Environment.',
            tags: ['Open Source', 'Overheid', 'Innovatie'],
            status: 'Open',
            start: '2025‑09',
            end: '',
            roles: ['Creative Developer', 'Communicatie'],
            link: '/overzicht/daw'
          },
          {
            id: 2,
            title: 'Global Universities',
            client: 'CSIRT.global',
            location: 'Internationaal',
            description: 'Onderzoek naar cybersecuritykwetsbaarheden in universiteiten wereldwijd.',
            tags: ['Cybersecurity', 'Onderzoek'],
            status: 'Open',
            start: '',
            end: '',
            roles: ['Security Researcher'],
            link: '/overzicht/global-universities'
          },
          {
            id: 3,
            title: 'Building DIVD.works',
            client: 'DIVD',
            location: 'Online',
            description: 'Bouwen aan het platform DIVD.works: tools, documentatie en workflows.',
            tags: ['Development', 'Platform', 'Tools'],
            status: 'Open',
            start: '',
            end: '',
            roles: ['Developer', 'Documentatie'],
            link: '/overzicht/divd-works'
          },
          {
            id: 4,
            title: 'Project ICY',
            client: 'Nederlandse Overheid',
            location: 'Nederland',
            description: 'Open‑source alternatief voor surveys binnen de overheid.',
            tags: ['Survey', 'Open Source'],
            status: 'Open',
            start: '',
            end: '',
            roles: ['Developer'],
            link: '/overzicht/project-icy'
          },
          {
            id: 5,
            title: 'VLAM.ai (Veilige Lokale AI Modellen)',
            client: 'Veiligheidsautoriteit',
            location: 'Nederland',
            description: 'Innovatieproject rond lokale, privacy‑bewuste AI modellen.',
            tags: ['AI', 'Privacy', 'Innovatie'],
            status: 'Bezig',
            start: '2025‑01',
            end: '2025‑12',
            roles: ['AI Specialist', 'Researcher'],
            link: '/overzicht/vlam-ai'
          },
          {
            id: 6,
            title: 'Nederlandse Postcode API',
            client: 'Open Data Nederland',
            location: 'Nederland',
            description: 'Onderhoud en uitbreiding van een API voor postcode-informatie.',
            tags: ['API', 'Open Data'],
            status: 'Gesloten',
            start: '2024‑05',
            end: '2025‑05',
            roles: ['Backend Developer'],
            link: '/overzicht/postcode-api'
          }
        ],

        // Sorting logic: toggle direction on same column
        sortBy(field) {
          if (this.sortField === field) {
            this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
          } else {
            this.sortField = field;
            this.sortDirection = 'asc';
          }
        },

        // Filter and sort projects for display
        sortedProjects() {
          let filtered = this.projects.filter((p) => {
            const matchesQuery = this.query
              ? (
                  p.title.toLowerCase().includes(this.query.toLowerCase()) ||
                  p.client.toLowerCase().includes(this.query.toLowerCase()) ||
                  p.location.toLowerCase().includes(this.query.toLowerCase()) ||
                  p.tags.some((tag) =>
                    tag.toLowerCase().includes(this.query.toLowerCase())
                  )
                )
              : true;

            const matchesStatus = this.selectedStatus
              ? p.status === this.selectedStatus
              : true;

            const matchesTag = this.selectedTag
              ? p.tags.includes(this.selectedTag)
              : true;

            return matchesQuery && matchesStatus && matchesTag;
          });

          const sorted = filtered.sort((a, b) => {
            let aVal = a[this.sortField] || '';
            let bVal = b[this.sortField] || '';

            // If sorting by roles array, join to string
            if (Array.isArray(aVal)) aVal = aVal.join(', ');
            if (Array.isArray(bVal)) bVal = bVal.join(', ');

            aVal = aVal.toString().toLowerCase();
            bVal = bVal.toString().toLowerCase();

            if (aVal < bVal) return this.sortDirection === 'asc' ? -1 : 1;
            if (aVal > bVal) return this.sortDirection === 'asc' ? 1 : -1;
            return 0;
          });

          return sorted;
        },

        // Open modal with project details
        openModal(project) {
          this.modalProject = project;
          this.modalOpen = true;
        },
      };
    }
  </script>
</body>
</html>
